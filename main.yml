- name: Server setup
  hosts: local

  vars:
    cloudflared_tunnel_token: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63633039353231343463346531666663393036623930353932656538373937613430343764393763
      6563653063363864363061386665303234396366363137330a383263366238333936333066396434
      38346664303333616265396338343161643734396466373133356465303666376135653634633666
      6634343130323537660a613861636235323234383235343436613734643237663364393233373966
      37663730346534663339396536333465353530386263653530336630363661303939356334343765
      33616663386263646237663732313735396136336232306463396533613766366139373665326530
      33643230663866336235353530393865623132346163303666323035613530366661643838633133
      64616138663461616234303663343237626338353863646461353932323832383561663231383761
      62626534313037363532323964323236326632666533356366336437353763303434316264316637
      39666532356638333137653437336664313538386631373462666235376462383138303264383636
      34396636376436336266366533306366333635323837346466623963653462643835313464626530
      38343364303536316462666339316465323165323762303163333132363737376366653238396664
      35313465336664356630343137633832316261653435336633633164383131656164

    security_door_camera_address: "10.0.50.200"
    security_door_camera_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63373262316261323435653934656666623735636133623065623237393835323337313336323937
      3131396664383433636139363439313866363830643261360a666231626362653966386532383164
      36623633623432393833303732396436656335626263393461313163383839353038353461666264
      3431643937376337330a636432636336643431643862303033316464393563313733313565313362
      33343963356131323964346632663066336365613465353632353866373961626430

    linkding_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30623035643735306330373766336239396237616238306464353530323262653733623539353032
      3662393337343437343164383131306338613632653031390a363061363434623365346239343864
      31663236613864633336346538346132393730326632333565616362383432353031376334366438
      3365623231363830380a306562333531383036326463623332336662303637666138366338623738
      6634
    linkding_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32316238343735313431393830656462376134663230343263663863333035316266643464333634
      6135633136363836323765626563313039653636313161300a313665633132613937373661373266
      36393534356561346434663331353431653136656237633739643039353933333038643932363565
      3035613536373964330a313064366361663131656634343131663237346136656632353337343033
      6131

    paisa_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34376430366664613865633235323239376434303961303134613331323233633163616534383937
      6337333732323733363865613830343463383765666265320a646231336432373630346237623565
      63343763316233323338373338633832303333626564653831636138326134646333353735623330
      6161383530303061310a356363333837396336613766356631363663613338356663393630623437
      3531
    paisa_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65376636633234613339383730326362646266646633393465356130363636326563333836653439
      3631636234633263323363306439663665376261353962380a643035636361616562303838626165
      37326263373166376563306464656566303066376536353935336364653265313931383738613065
      3930303764396139300a386138346634626438646333313430313135643365653033323331313933
      3364

  roles:
    - role: common
      vars:
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    - role: rclone
      vars:
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'
        google_client_id: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          63613238303361656666646637386166353061633465366330343663366564326239623062633331
          3762316164383063323333343432623030373761663039310a353461626231643039333262636263
          66383364313161313033646461363433626334306536613561316539623862373066646232363831
          3831656665373032330a633138653533613164393830313765376134653739393437663939643632
          31643366376665373464303466663930653964623232626562363330636361383962366639333433
          37303637333335306665373232366231373039663639366563346536633231366636353832323262
          36366235353565663861386438366536663235323066373966633764396264383965323138323034
          33656538653363313638
        google_client_secret: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          37616466633331333763346163316438323135613664363331623861333031313436623237646264
          6263623063373438343835303334373837623233613337370a663838613061626464356433366333
          31343632343861343033376364666361616435393837393766623065353030653863633661653730
          3862316335333934310a653035643032353536646135373665333736663239653532306465383931
          34353832386664326138623633396561636135353665343862663233303830616366306236666434
          6366613034666338313035333636626332373938613366313632
        google_auth_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          64663330653538306138396338613139623435623336366564646237396433623663613561336336
          3561343664643731333561316363356133306533633064610a373865386233316233626634626433
          64363763343731643766353332316338613838613538613337343931646637303032626330616434
          6662656465613438390a643161376230343165353639333532343065323134306331313032376166
          62663363386231633037393163616435323634326536636131383634333939613637323465326238
          38383563343763656466643736333666323636393830386130346439633565663366653732623532
          61613430323234323464383039383832343565316564643366633232353164393936336137663837
          35363966663132663939393732333732646433316630666134303530303438623035663831666437
          39616462343338323836353139333062393565383665616362623635306566643835323436333565
          39623661633730663933383838343965316566663332323831373936336232333439383962363463
          65636261376531316662616264343433383231326462613932336566313662653933333838396562
          31333636353737323261333766613235643661363831613539323934313030353735356630633661
          39356533626330663465646435363162303935663537346433333938613866393364363335393530
          64306438323361326133373936643837366637386234326634646436366165646538646362346335
          38613263346263323862326533393533613233323161333535313864373161616363306564353435
          39333234333864383363656563656636633762373938363762616662333630303432363233356464
          65316134626432373330663039633239663030636536643533386565316537336433613439623164
          30346330333039383837383236376632363965383837653064663133313062663435343564373463
          34343634656130643161383637386161333031346563636237326533373266363861616637316361
          38643939393839623635303532336133653736346430376134333535623837613036373666663162
          61613138373034656130346130633332623132373263373332343837623737353832313564653661
          62343339333331366534393662366664386131323566653665363766636130616266396131366565
          31323036626263313066643430353134663334643431613364376261393962363763326562323164
          39646562343839633366303164356232343664316163323831363034366431376461343661386665
          36643232373833393161646135643836363631353231386332383061643361316264333537393632
          6432306539313530376234623236373462616161643035646465

    - role: cloudflared
      vars:
        cloudflared_project_name: cloudflared
        cloudflared_tunnel_name: cloudflared
        cloudflared_container_name: cloudflared
        cloudflared_network_name: cloudflared
        cloudflared_token: "{{ cloudflared_tunnel_token }}"

    - role: frigate
      vars:
        frigate_rtsp_stream1: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream1"
        frigate_rtsp_stream2: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream2"
        frigate_container_name: frigate
        frigate_project_name: frigate
        frigate_image: ghcr.io/blakeblackshear/frigate:0.15.2-rocm
        frigate_data_dir: /media/homelab/data/frigate
        frigate_config_file: /media/homelab/data/frigate/config/config.yml
        frigate_network_name: cloudflared
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    - role: linkding
      vars:
        ld_project_name: linkding
        ld_container_name: linkding
        ld_superuser_name: "{{ linkding_user }}"
        ld_superuser_password: "{{ linkding_password }}"
        ld_data_dir: /media/homelab/data/linkding
        ld_network_name: cloudflared

    - role: paisa
      vars:
        paisa_project_name: paisa
        paisa_container_name: paisa
        paisa_user_name: "{{ paisa_user }}"
        paisa_user_password: "{{ paisa_password }}"
        paisa_data_dir: /media/homelab/data/paisa
        paisa_network_name: cloudflared

- name: Server setup
  hosts: local

  vars:
    cloudflared_tunnel_token: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63633039353231343463346531666663393036623930353932656538373937613430343764393763
      6563653063363864363061386665303234396366363137330a383263366238333936333066396434
      38346664303333616265396338343161643734396466373133356465303666376135653634633666
      6634343130323537660a613861636235323234383235343436613734643237663364393233373966
      37663730346534663339396536333465353530386263653530336630363661303939356334343765
      33616663386263646237663732313735396136336232306463396533613766366139373665326530
      33643230663866336235353530393865623132346163303666323035613530366661643838633133
      64616138663461616234303663343237626338353863646461353932323832383561663231383761
      62626534313037363532323964323236326632666533356366336437353763303434316264316637
      39666532356638333137653437336664313538386631373462666235376462383138303264383636
      34396636376436336266366533306366333635323837346466623963653462643835313464626530
      38343364303536316462666339316465323165323762303163333132363737376366653238396664
      35313465336664356630343137633832316261653435336633633164383131656164

    security_door_camera_address: "10.0.50.200"
    security_door_camera_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63373262316261323435653934656666623735636133623065623237393835323337313336323937
      3131396664383433636139363439313866363830643261360a666231626362653966386532383164
      36623633623432393833303732396436656335626263393461313163383839353038353461666264
      3431643937376337330a636432636336643431643862303033316464393563313733313565313362
      33343963356131323964346632663066336365613465353632353866373961626430

    linkding_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30623035643735306330373766336239396237616238306464353530323262653733623539353032
      3662393337343437343164383131306338613632653031390a363061363434623365346239343864
      31663236613864633336346538346132393730326632333565616362383432353031376334366438
      3365623231363830380a306562333531383036326463623332336662303637666138366338623738
      6634
    linkding_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32316238343735313431393830656462376134663230343263663863333035316266643464333634
      6135633136363836323765626563313039653636313161300a313665633132613937373661373266
      36393534356561346434663331353431653136656237633739643039353933333038643932363565
      3035613536373964330a313064366361663131656634343131663237346136656632353337343033
      6131

  roles:
    - role: common
      vars:
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    - role: cloudflared
      vars:
        cloudflared_project_name: cloudflared
        cloudflared_tunnel_name: cloudflared
        cloudflared_container_name: cloudflared
        cloudflared_network_name: cloudflared
        cloudflared_token: "{{ cloudflared_tunnel_token }}"

    - role: frigate
      vars:
        frigate_rtsp_stream1: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream1"
        frigate_rtsp_stream2: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream2"
        frigate_container_name: frigate
        frigate_project_name: frigate
        frigate_image: ghcr.io/blakeblackshear/frigate:stable-rocm
        frigate_data_dir: /media/homelab/data/frigate
        frigate_config_file: /media/homelab/data/frigate/config/config.yml
        frigate_network_name: cloudflared
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    - role: linkding
      vars:
        ld_project_name: linkding
        ld_container_name: linkding
        ld_superuser_name: "{{ linkding_user }}"
        ld_superuser_password: "{{ linkding_password }}"
        ld_data_dir: /media/homelab/data/linkding
        ld_network_name: cloudflared

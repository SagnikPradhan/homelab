- name: Server setup
  hosts: local

  vars:
    cloudflared_tunnel_token: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63633039353231343463346531666663393036623930353932656538373937613430343764393763
      6563653063363864363061386665303234396366363137330a383263366238333936333066396434
      38346664303333616265396338343161643734396466373133356465303666376135653634633666
      6634343130323537660a613861636235323234383235343436613734643237663364393233373966
      37663730346534663339396536333465353530386263653530336630363661303939356334343765
      33616663386263646237663732313735396136336232306463396533613766366139373665326530
      33643230663866336235353530393865623132346163303666323035613530366661643838633133
      64616138663461616234303663343237626338353863646461353932323832383561663231383761
      62626534313037363532323964323236326632666533356366336437353763303434316264316637
      39666532356638333137653437336664313538386631373462666235376462383138303264383636
      34396636376436336266366533306366333635323837346466623963653462643835313464626530
      38343364303536316462666339316465323165323762303163333132363737376366653238396664
      35313465336664356630343137633832316261653435336633633164383131656164

    security_door_camera_address: "10.0.50.200"
    security_door_camera_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63373262316261323435653934656666623735636133623065623237393835323337313336323937
      3131396664383433636139363439313866363830643261360a666231626362653966386532383164
      36623633623432393833303732396436656335626263393461313163383839353038353461666264
      3431643937376337330a636432636336643431643862303033316464393563313733313565313362
      33343963356131323964346632663066336365613465353632353866373961626430

    linkding_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      30623035643735306330373766336239396237616238306464353530323262653733623539353032
      3662393337343437343164383131306338613632653031390a363061363434623365346239343864
      31663236613864633336346538346132393730326632333565616362383432353031376334366438
      3365623231363830380a306562333531383036326463623332336662303637666138366338623738
      6634
    linkding_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      32316238343735313431393830656462376134663230343263663863333035316266643464333634
      6135633136363836323765626563313039653636313161300a313665633132613937373661373266
      36393534356561346434663331353431653136656237633739643039353933333038643932363565
      3035613536373964330a313064366361663131656634343131663237346136656632353337343033
      6131

    paisa_user: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      34376430366664613865633235323239376434303961303134613331323233633163616534383937
      6337333732323733363865613830343463383765666265320a646231336432373630346237623565
      63343763316233323338373338633832303333626564653831636138326134646333353735623330
      6161383530303061310a356363333837396336613766356631363663613338356663393630623437
      3531
    paisa_password: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      65376636633234613339383730326362646266646633393465356130363636326563333836653439
      3631636234633263323363306439663665376261353962380a643035636361616562303838626165
      37326263373166376563306464656566303066376536353935336364653265313931383738613065
      3930303764396139300a386138346634626438646333313430313135643365653033323331313933
      3364

    google_client_id: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      63613238303361656666646637386166353061633465366330343663366564326239623062633331
      3762316164383063323333343432623030373761663039310a353461626231643039333262636263
      66383364313161313033646461363433626334306536613561316539623862373066646232363831
      3831656665373032330a633138653533613164393830313765376134653739393437663939643632
      31643366376665373464303466663930653964623232626562363330636361383962366639333433
      37303637333335306665373232366231373039663639366563346536633231366636353832323262
      36366235353565663861386438366536663235323066373966633764396264383965323138323034
      33656538653363313638
    google_client_secret: !vault |
      $ANSIBLE_VAULT;1.1;AES256
      37616466633331333763346163316438323135613664363331623861333031313436623237646264
      6263623063373438343835303334373837623233613337370a663838613061626464356433366333
      31343632343861343033376364666361616435393837393766623065353030653863633661653730
      3862316335333934310a653035643032353536646135373665333736663239653532306465383931
      34353832386664326138623633396561636135353665343862663233303830616366306236666434
      6366613034666338313035333636626332373938613366313632

  roles:
    - role: common
      vars:
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    # - role: stefangweichinger.ansible_rclone
    #   become: yes
    #   vars:
    #     ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'
    #     install_manpages: false
    #     rclone_configs:
    #       - name: gdrive
    #         properties:
    #           type: "drive"
    #           scope: "drive"
    #           client_id: "{{ google_client_id }}"
    #           client_secret: "{{ google_client_secret }}"

    - role: cloudflared
      vars:
        cloudflared_project_name: cloudflared
        cloudflared_tunnel_name: cloudflared
        cloudflared_container_name: cloudflared
        cloudflared_network_name: cloudflared
        cloudflared_token: "{{ cloudflared_tunnel_token }}"

    - role: frigate
      vars:
        frigate_rtsp_stream1: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream1"
        frigate_rtsp_stream2: "rtsp://admin:{{ security_door_camera_password }}@{{ security_door_camera_address }}:554/stream2"
        frigate_container_name: frigate
        frigate_project_name: frigate
        frigate_image: ghcr.io/blakeblackshear/frigate:0.15.2-rocm
        frigate_data_dir: /media/homelab/data/frigate
        frigate_config_file: /media/homelab/data/frigate/config/config.yml
        frigate_network_name: cloudflared
        ansible_become_password: '{{ lookup("env", "ANSIBLE_BECOME_PASSWORD") }}'

    - role: linkding
      vars:
        ld_project_name: linkding
        ld_container_name: linkding
        ld_superuser_name: "{{ linkding_user }}"
        ld_superuser_password: "{{ linkding_password }}"
        ld_data_dir: /media/homelab/data/linkding
        ld_network_name: cloudflared

    - role: paisa
      vars:
        paisa_project_name: paisa
        paisa_container_name: paisa
        paisa_user_name: "{{ paisa_user }}"
        paisa_user_password: "{{ paisa_password }}"
        paisa_data_dir: /media/homelab/data/paisa
        paisa_network_name: cloudflared
